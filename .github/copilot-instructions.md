# zolty-blog â€” AI Assistant Instructions

## Project Overview

This is the source repository for [blog.zolty.systems](https://blog.zolty.systems/), a public-facing homelab and infrastructure blog. The site is built with Hugo (static site generator) using the PaperMod theme, served via AWS CloudFront + S3, with content generated by AWS Bedrock and deployed via GitHub Actions.

## Critical Rules

- **Pseudonym only:** The author is always "zolty". Never use real names, email addresses, or any personally identifiable information anywhere in the codebase or content.
- **No secrets in code:** AWS keys, API tokens, and credentials live in GitHub Actions secrets only. Never hardcode them.
- **No profanity or illegal content:** This is a public-facing blog.
- **Git identity:** Commits should use `zolty <zolty@zolty.systems>` as the author.

## Architecture

- **Static site:** Hugo generates static HTML, deployed to S3, served via CloudFront CDN
- **No dynamic backend:** Comments use Giscus (GitHub Discussions). No server-side processing.
- **CI/CD:** GitHub Actions with self-hosted runners on k3s (ARC)
- **Infrastructure:** Terraform manages AWS resources (S3, CloudFront, Route53, ACM, IAM)
- **Content generation:** AWS Bedrock (Claude 3.5 Sonnet) generates article drafts via `content-gen/scripts/generate_article.py`

## Directory Structure

| Path | Purpose |
|------|---------|
| `hugo/` | Hugo site root (config, content, layouts, static assets) |
| `hugo/config/_default/` | Hugo configuration (hugo.toml, params.toml, menus.toml, markup.toml) |
| `hugo/content/posts/` | Blog articles as page bundles (each post is a directory with index.md) |
| `hugo/layouts/partials/` | Custom partials (ads, comments, SEO) |
| `hugo/layouts/shortcodes/` | Custom shortcodes (ad placement) |
| `terraform/` | AWS infrastructure (S3, CloudFront, Route53, ACM, IAM) |
| `content-gen/` | Bedrock content generation scripts and prompts |
| `.github/workflows/` | CI/CD workflows (deploy, review, terraform, generate-content) |

## Hugo Content Conventions

- Articles use **page bundles**: each post is a directory containing `index.md` and an optional `images/` subdirectory
- Front matter must include: `title`, `date`, `author` ("zolty"), `description` (150-160 chars), `tags`, `categories`
- Google Ads and Analytics are only rendered in production builds (`hugo.Environment == "production"`)
- The `{{</* ad */>}}` shortcode inserts an in-article ad placement

## Deployment

- Push to `main` with changes in `hugo/**` triggers automatic build and deploy
- Hugo builds with `--minify --environment production`
- Two-pass S3 sync: HTML/XML/JSON with 1hr cache, static assets with 1yr immutable cache
- CloudFront invalidation runs after every deploy

## Terraform

- State stored in S3: `k3s-homelab-tfstate-855878721457` with key `zolty-blog/terraform.tfstate`
- ACM certificate must be in `us-east-1` (CloudFront requirement)
- Changes to `terraform/` on `main` trigger auto-apply

## Content Generation

- Run `generate-content.yml` workflow with a topic to generate an article draft
- Bedrock creates a Hugo page bundle and opens a PR for review
- Weekly scheduled runs pull from `content-gen/prompts/topics.json` backlog
- System prompt enforces pseudonym usage and blog style guidelines

## Common Tasks

### Local development
```bash
cd hugo && hugo server --buildDrafts
```

### Add a new article manually
```bash
mkdir -p hugo/content/posts/my-new-article
# Create hugo/content/posts/my-new-article/index.md with front matter
```

### Generate an article via Bedrock
Trigger the `generate-content.yml` workflow via GitHub Actions UI with a topic.

### Run Terraform
```bash
cd terraform && terraform init && terraform plan
```
